<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Socket.IO Test</title>
  </head>
  <body>
    <h2>Socket.IO Client Test</h2>

    <input type="text" id="userIdInput" placeholder="Enter your userId" />
    <button onclick="joinUserRoom()">Join User Room</button>

    <hr />

    <input type="text" id="tripIdInput" placeholder="Enter Trip ID" />
    <input type="text" id="messageInput" placeholder="Type a message" />
    <button onclick="joinTripRoom()">Join Trip Room</button>
    <button onclick="sendMessage()">Send Message</button>

    <ul id="messages"></ul>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
      const socket = io("http://localhost:8000"); // âœ… Use the correct backend port

      socket.on("connect", () => {
        console.log("ðŸŸ¢ Connected:", socket.id);
      });

      socket.on("disconnect", () => {
        console.log("ðŸ”´ Disconnected from server");
      });

      // âœ… Notification listener (keep only one)
      socket.on("notification", (data) => {
        console.log("ðŸ“¬ Notification:", data);
        alert("Notification: " + data.message);
      });

      // âœ… New chat message listener
      socket.on("newMessage", (msg) => {
        const li = document.createElement("li");
        li.textContent = `[${new Date(msg.sentAt).toLocaleTimeString()}] ${
          msg.senderName || msg.sender
        }: ${msg.message}`;
        document.getElementById("messages").appendChild(li);
      });

      function joinUserRoom() {
        const userId = document.getElementById("userIdInput").value;
        socket.emit("joinUserRoom", userId);
        console.log("Joined user room:", userId);
      }

      function joinTripRoom() {
        const tripId = document.getElementById("tripIdInput").value;
        socket.emit("joinTripRoom", tripId);
        console.log("Joined trip room:", tripId);
      }

      function sendMessage() {
        const tripId = document.getElementById("tripIdInput").value;
        const message = document.getElementById("messageInput").value;
        const sender = document.getElementById("userIdInput").value; // Optional, simulate sender ID
        socket.emit("sendMessage", { tripId, sender, message });
        document.getElementById("messageInput").value = "";
      }
    </script>
  </body>
</html>
